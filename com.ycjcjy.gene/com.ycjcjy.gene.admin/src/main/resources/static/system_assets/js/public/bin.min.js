$(function(){new TapLocker();$("#indexMenuBtn").addClass("active");initDataPicker();unComments("tpl-pagination")});$.ajaxSetup({type:"POST",error:function(jqXHR,textStatus,errorThrown){switch(jqXHR.status){case (500):errorCheckOnOffLine(true,jqXHR,"500");break;case (400):errorCheckOnOffLine(true,jqXHR,"400");break;case (401):errorCheckOnOffLine(true,jqXHR,"401");break;case (403):errorCheckOnOffLine(true,jqXHR,"403");break;case (404):errorCheckOnOffLine(false,jqXHR,"404");break;case (408):errorCheckOnOffLine(false,jqXHR,"408");break;case (518):errorCheckOnOffLine(false,jqXHR,"518");break;case (501):errorCheckOnOffLine(false,jqXHR,"501");break;case (200):errorCheckOnOffLine(false,jqXHR,"200");break;default:error()}$.AMUI.progress.done()}});function errorCheckOnOffLine(mode,jqXHR,code){if(jqXHR.status==200&&jqXHR.responseText.indexOf("登录页面")){$("#alert-modal").on("closed.modal.amui",function(){$(this).off("closed.modal.amui");parent.location.reload()});alert("登录已失效,请重新登陆!");return}if(mode){window.location.href="/error/"+code;return}if((typeof(jqXHR.responseJSON)!="undefined")){window.location.href="/error/"+code}else{error()}}function goBack(){window.history.back(-1)}function clearUploadImg(target){var $group=$(target).parents(".am-form-group");var $img=$group.find("img");$img.attr("src","");var $input=$group.find("input");$input.val("")}function tabToTab(target){var $menu=$(window.parent.document.body).find("#hideMenu");$menu.attr("data-name",$(target).attr("data-name"));$menu.attr("data-url",$(target).attr("data-url"));$menu.click()}var openNewTab=function(target){var locker=new TapLocker();locker.setIsLock(true);clearMenuActive();var $parentsMenu=$(target).parents(".parent-menu").children(".sidebar-nav-sub-title");if($parentsMenu.length>0){$parentsMenu.addClass("active")}else{$(target).addClass("active")}if(locker.getIsLock()){var $tab=$(window.parent.document.body).find("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav");var $bd=$tab.find(".am-tabs-bd");var $link=$(target).attr("data-url");if($link.indexOf("http://")!=-1||$link.indexOf("http://")!=-1){window.open($link);return}else{var $ctx=$("title").data("ctx");$link=$ctx+$link}var $name=$(target).attr("data-name");var $onebeanTabs=$nav.children("li");var isRepeat=isRepeatTab($onebeanTabs,$link);if(isRepeat==-1){var tab={name:"",url:""};tab.name=$name;tab.url=$link;$nav.append(template("tpl-onebean-tab",tab));var breadCrumbs=eachBreadCrumbs($link,$name,true);var operator=($link.indexOf("?")!=-1)?"&":"?";$link+=operator+"breadCrumbsStr="+encodeURI(JSON.stringify(breadCrumbs));var $iframe=$("<iframe width='100%' src='"+$link+"' class='am-tab-panel onebean-frame' onload='reHeightonebeanFrame(this)'></iframe>");$bd.append($iframe);$tab.tabs("refresh");var index=$onebeanTabs.length;$tab.tabs("open",index);$tab.tabs("refresh")}else{$tab.tabs("open",isRepeat);$tab.tabs("refresh")}}locker.setIsLock(false)};function clearMenuActive(){var menus=$(".sidebar-nav").find("a");$.each(menus,function(i,e){if($(e).hasClass("active")){$(e).removeClass("active")}})}$("body").on("click",".sidebar-nav-sub-title",function(){$(this).attr("status","open");var subs=$(".sidebar-nav").find(".sidebar-nav-sub-ico");var menuA;$.each(subs,function(i,e){menuA=$(e).parent("a");if($(e).hasClass("sidebar-nav-sub-ico-rotate")&&menuA.attr("status")!="open"){menuA.click()}});$(this).attr("status","close");clearMenuActive();$(this).addClass("active")});$("body").on("click",".del-line-btn",function(){$(this).parents(".onebean-line-tr").remove()});$(".tpl-switch-btn").on("mousedown click",function(){var $hider=$(this).siblings(".tpl-switch-hider");if($(this).is(":checked")){$hider.val(1)}else{$hider.val(0)}$hider.attr("name",$(this).attr("name"));$(this).removeAttr("name")});function isRepeatTab($onebeanTabs,href){var result=-1;$.each($onebeanTabs,function(i,e){result=($(e).children("a").data("url")==href)?i:result});return result}$("body").on("click",".am-icon-close",function(){var locker=new TapLocker();locker.setIsLock(true);if(locker.getIsLock()){var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav");var $Jtabs=$nav.children("li");var $bd=$tab.find(".am-tabs-bd");var $item=$(this).closest("li");var index=$Jtabs.index($item);var tabsWidthSum=calSumWidth($Jtabs);reduceOneWidth($Jtabs[index],$Jtabs,tabsWidthSum);$item.remove();$bd.find(".am-tab-panel").eq(index).remove();$tab.tabs("open",index>0?index-1:index+1);$tab.tabs("refresh")}locker.setIsLock(false)});function emptyTabs(target){var locker=new TapLocker();locker.setIsLock(true);if(locker.getIsLock()){var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav").children("li");var $bd=$tab.find(".am-tabs-bd").children("iframe");for(var i=0;i<$nav.length;i++){if(i>0){$nav[i].remove();$bd[i].remove()}}$tab.tabs("refresh");$(target).parents(".am-dropdown").dropdown("close");$(".am-nav-tabs").animate({marginLeft:-0+"px"},"fast")}locker.setIsLock(false)}function closeCurrentTabs(target){var locker=new TapLocker();
    locker.setIsLock(true);if(locker.getIsLock()){var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav").children("li");var $bd=$tab.find(".am-tabs-bd").children("iframe");var tabsWidthSum=calSumWidth($nav);var index;for(var i=0;i<$nav.length;i++){if(i>0){if($($nav[i]).hasClass("am-active")){index=$nav.index($nav[i]);reduceOneWidth($nav[i],$nav,tabsWidthSum);$nav[i].remove();$bd[i].remove()}}}$tab.tabs("open",index>0?index-1:index+1);$tab.tabs("refresh");$(target).parents(".am-dropdown").dropdown("close")}locker.setIsLock(false)}function reduceOneWidth(li,nav,tabsWidthSum){var tempWidth=$(li).outerWidth(true);var liIndex=nav.index(li);var navLength=nav.length;if(liIndex==navLength-1){var tabWidth=$("#onebean-frame-container").outerWidth(true);var tabButtonWidth=$(".onebean-nav-buttons").outerWidth(true);var tabShowWidth=tabWidth-tabButtonWidth;var allPageSum=parseInt(tabsWidthSum/tabShowWidth);var allPageSumExcl=parseInt((tabsWidthSum-tempWidth)/tabShowWidth);if((allPageSum-allPageSumExcl)>=1){checkBarLeft()}}}function closeOtherTabs(target){var locker=new TapLocker();locker.setIsLock(true);if(locker.getIsLock()){var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav").children("li");var $bd=$tab.find(".am-tabs-bd").children("iframe");var index;for(var i=0;i<$nav.length;i++){if(i>0){if(!($($nav[i]).hasClass("am-active"))){$nav[i].remove();$bd[i].remove()}else{index=$nav.index($nav[i])}}}$tab.tabs("open",index);$tab.tabs("refresh");$(target).parents(".am-dropdown").dropdown("close");$(".am-nav-tabs").animate({marginLeft:-0+"px"},"fast")}locker.setIsLock(false)}$("body").on("change",".onebean-param-select-box",function(){resetPageNumber();initDataTable()});$("body").on("click",".query-button",function(){resetPageNumber();initDataTable()});$("body").on("click",".pagination-number",function(){var choosePage=$(this).children("a").html();$("#tpl-pagination").attr("currentPage",choosePage);initDataTable()});$("body").on("click",".pagination-frist",function(){resetPageNumber();initDataTable()});$("body").on("click",".pagination-end",function(){var choosePage=$("#tpl-pagination").attr("totalPages");$("#tpl-pagination").attr("currentPage",choosePage);initDataTable()});$("body").on("click",".pagination-next",function(){var choosePage=parseInt($("#tpl-pagination").attr("currentPage"))+1;$("#tpl-pagination").attr("currentPage",choosePage);initDataTable()});$("body").on("click",".pagination-previous",function(){var choosePage=parseInt($("#tpl-pagination").attr("currentPage"))-1;$("#tpl-pagination").attr("currentPage",choosePage);initDataTable()});$(".reset-button").on("click",function(){$(".paramFrom").data("flush","0");$(".paramFrom")[0].reset();$("#limitSelector").children("option").eq(1).attr("selected",true);$("#orderBySelector").children("option").eq(0).attr("selected",true);$("#limitSelector").trigger("changed.selected.amui");$("#orderBySelector").trigger("changed.selected.amui");$(".onebean-param-select-box").selected("destroy");$(".onebean-param-select-box").selected();$(".paramFrom").data("flush","1");initDataTable()});$(".paramFrom").keydown(function(e){var e=e||event,keycode=e.which||e.keyCode;if(keycode==13){initDataTable()}});function resetPageNumber(){$("#tpl-pagination").attr("currentPage",1)}function initTreeAsyncSingleSelect(title,self_id,url){$(".am-popup-title").html(title);$("#tree-template").tree({dataSource:function(options,callback){if(options.type=="folder"||typeof(options.type)=="undefined"){if(typeof(options.childList)=="object"){callback({data:options.childList})}else{doPost(url,{parent_id:options.id,self_id:self_id},function(res){callback({data:res.data})})}}},multiSelect:false,cacheItems:true,folderSelect:true});setTimeout(function(){$("#tree-template").tree("selectItem",$(".am-tree-selected"))},50)}function initTreeSyncMultiSelect(title,roleId,url,$treeTemplate){$(".am-popup-title").html(title);$treeTemplate.tree({dataSource:function(options,callback){if(options.type=="folder"||typeof(options.type)=="undefined"){if(typeof(options.childList)=="object"){callback({data:options.childList})}else{doPost(url,{roleId:roleId},function(res){callback({data:res.data})})}}},cacheItems:true,multiSelect:true,folderSelect:true,itemSelect:true,itemSelectedIcon:"file",folderIcon:"folder",folderOpenIcon:"folder-open",itemIcon:"file"});setTimeout(function(){$treeTemplate.tree("selectItemSafe",$(".selected-item"))},200);$treeTemplate.on("updated.tree.amui",function(event,data){var childs=$(data.item).find(".am-tree-item,.am-tree-branch");var parents=$(data.item).parents(".am-tree-branch");$.each(parents,function(index,item){if(data.eventType==="selected"){if(!$(item).is(".am-tree-selected")){$treeTemplate.tree("selectItemSafe",$(item))}}});$.each(childs,function(index,item){if(data.eventType==="selected"){if(!$(item).is(".am-tree-selected")){$treeTemplate.tree("selectItemSafe",$(item))}}else{if(data.eventType==="deselected"){if($(item).is(".am-tree-selected")){$treeTemplate.tree("selectItemSafe",$(item))
}}}})})}function treeTipsModal($tips){$tips.modal("open")}$("#limitSelector").on("change",function(){if($(".paramFrom").data("flush")=="1"){initDataTable()}});$("#orderBySelector").on("change",function(){if($(".paramFrom").data("flush")=="1"){initDataTable()}});$("body").on("click",".list-del-button",function(){$(".confirm-modal-title").html("警告");$(".confirm-modal-message").html("你，确定要删除这条记录吗？");$(".confirm-modal-btn-cancel").html("取消");$(".confirm-modal-btn-confirm").html("确定");$("#confirm-modal").modal({relatedTarget:this,onConfirm:function(){var $link=$(this.relatedTarget).data("url");doGet($link,null,function(){initDataTable()})},onCancel:function(){}})});function addbreadCrumbsToUrl(url){var breadCrumbs=justEachBreadCrumbs(false);var operator=(url.indexOf("?")!=-1)?"&":"?";url+=operator+"breadCrumbsStr="+encodeURI(JSON.stringify(breadCrumbs));return url}function doPost(url,param,completeHandler){var $ctx=$("title").data("ctx");url=$ctx+url;$.AMUI.progress.start();try{url=addbreadCrumbsToUrl(url)}catch(err){}$.ajax({url:url,type:"POST",dataType:"json",data:param,success:function(data){completeHandler(data);$.AMUI.progress.done()}})}function doPostSync(url,param,completeHandler){$.AMUI.progress.start();$.ajax({url:url,async:false,type:"POST",dataType:"json",data:param,success:function(data){completeHandler(data);$.AMUI.progress.done()}})}function doGet(url,param,completeHandler){var $ctx=$("title").data("ctx");url=$ctx+url;$.AMUI.progress.start();try{url=addbreadCrumbsToUrl(url)}catch(err){}$.ajax({url:url,type:"GET",dataType:"json",contentType:"utf-8",data:param,success:function(data){completeHandler(data);$.AMUI.progress.done()}})}function doGetHtml(url,param,completeHandler){$.ajax({url:url,type:"GET",dataType:"html",contentType:"utf-8",data:param,success:function(data){completeHandler(data)}})}function alert(title,message,buttonTitle){$(".alert-modal-message").html(message);$(".alert-modal-title").html(title);$(".alert-modal-button").html(buttonTitle);$("#alert-modal").modal("open")}function alert(message){$(".alert-modal-message").html(message);$(".alert-modal-title").html("提示");$(".alert-modal-button").html("好哒");$("#alert-modal").modal("open")}function error(){$(".alert-modal-message").html("程序出了一丢丢小意外,赶紧联系程序猿解决吧!");$(".alert-modal-title").html("诶呀麻鸭,服务见鬼啦! |*´Å`)ﾉ ");$(".alert-modal-button").html("额...好吧");$("#alert-modal").modal("open")}function uploadFile(completeHandler,target){var disabled=$(target).attr("disabled");if(disabled=="disabled"){return}initUploadModal(completeHandler);$("#upload-modal").modal("open")}function initUploadModal(completeHandler){var $uploadTips=$("#upload-modal");$uploadTips.html(template("tpl-uploadTips",null));var $link="/upload/uploadmultipartfile";$link=$("title").data("ctx")+$link;var upload=$("#uploadFileWidget").AmazeuiUpload({url:$link,downloadUrl:"/upload/downfile",maxFiles:5,maxFileSize:10,multiThreading:false,useDefTemplate:true,dropType:true,pasteType:false});upload.init();$("body").on("close.modal.amui","#upload-modal",function(){upload.destory()});$("body").on("click",".upload-file-submit",function(){var arr=upload.selectResult();if(arr.length>0){completeHandler(arr)}})}function formatQueryFromParam(){var conditionStr="";var paramList=$(".paramFrom").find(".paramInput");for(var i=0;i<paramList.length;i++){var $tepm=$(paramList[i]);if($tepm.val()!=""){if(conditionStr.length>0){conditionStr+="^"}conditionStr+=$tepm.attr("param-pattern")+$tepm.val()}}return conditionStr}function reHeightonebeanFrame(target){var mainheight=$(target).contents().find("body").height();$(target).height(mainheight)}function checkBarLeft(){var locker=new TapLocker();locker.setIsLock(true);if(locker.getIsLock()){var marginLeftVal=(Math.abs(parseInt($(".am-nav-tabs").css("margin-left"))));var tabWidth=$("#onebean-frame-container").outerWidth(true);var tabButtonWidth=$(".onebean-nav-buttons").outerWidth(true);var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav");var $Jtabs=$nav.find("li");var tabsWidthNum=0;var offsetVal=0;var tabShowWidth=tabWidth-tabButtonWidth;var xPoint=marginLeftVal-tabShowWidth;var tempWidth=0;if(xPoint>0){var $item=$Jtabs.first();while(tabsWidthNum<xPoint){tempWidth=$($item).outerWidth(true);tabsWidthNum+=tempWidth;$item=$Jtabs.next()}offsetVal=tabsWidthNum}else{offsetVal=0}$(".am-nav-tabs").animate({marginLeft:-offsetVal+"px"},"fast")}locker.setIsLock(false)}function checkBarRight(){var locker=new TapLocker();locker.setIsLock(true);if(locker.getIsLock()){var marginLeftVal=Math.abs(parseInt($(".am-nav-tabs").css("margin-left")));var tabWidth=$("#onebean-frame-container").outerWidth(true);var tabButtonWidth=$(".onebean-nav-buttons").outerWidth(true);var $tab=$("#onebean-frame-container");var $nav=$tab.find(".am-tabs-nav");var $Jtabs=$nav.children("li");var tabsWidthSum=calSumWidth($Jtabs);var tabsWidthNum=0;var offsetVal=0;var tabShowWidth=tabWidth-tabButtonWidth;var leftLength=marginLeftVal+tabShowWidth;var $item=$Jtabs.first();while(tabsWidthNum<leftLength){var tempWidth=$($item).outerWidth(true);
    tabsWidthNum+=tempWidth;offsetVal=((marginLeftVal+tabShowWidth-tabsWidthNum)<0)?(tabsWidthNum-tempWidth):(tabsWidthNum+tempWidth);$item=$Jtabs.next()}if((tabsWidthSum-marginLeftVal-tabShowWidth)>0){$(".am-nav-tabs").animate({marginLeft:-offsetVal+"px"},"fast")}}locker.setIsLock(false)}function calSumWidth(target){var width=0;$.each(target,function(index,item){width+=$(item).outerWidth(true)});return width}var TapLocker=(function(){var instance;var TapLocker=function(){if(instance){return instance}return instance=this};TapLocker.prototype.isLock=false;TapLocker.prototype.setIsLock=function(bool){this.isLock=bool};TapLocker.prototype.getIsLock=function(){return this.isLock};return TapLocker})();function trim(str){return str.replace(/(^\s*)|(\s*$)/g,"")}function isEmptyStr(str){if(str==""){return true}var regu="^[ ]+$";var re=new RegExp(regu);return re.test(str)}$.fn.serializeChildListJson=function(parent){var $from=this;var $trs=$from.find(".onebean-line-tr");var jsonArr=new Array();var tempValue="";$trs.each(function(i,e){var $obj=new Object();var $iputs=$(e).find(".onebean-child-list-item");$iputs.each(function(index,element){var value=$(element).val();var name=$(element).attr("name");tempValue="";if(value!=null&&Object.prototype.toString.call(value)=="[object Array]"){$(value).each(function(i_,e_){tempValue+=e_+","});tempValue=tempValue.substr(0,tempValue.length-1);value=tempValue}$obj[name]=value});jsonArr.push($obj)});parent["childList"]=jsonArr;return JSON.stringify(parent)};$.fn.serializeJson=function(){var arr=this.serializeArray();var json={};arr.forEach(function(item){var name=item.name;var value=trim(item.value);if(!json[name]){json[name]=value}else{if($.isArray(json[name])){json[name].push(value)}else{json[name]=[json[name],value]}}});return json};function serializeChildFromJson(arr){var $length;var $obj;var json=new Array();for(var Key in arr){if(typeof($length)!="undefined"){break}$length=arr[Key].length}for(var i=0;i<$length;i++){$obj=new Object();for(var key in arr){$obj[key]=arr[key][i]}json.push($obj)}return json}function routingPage($url,$title){var $ctx=$("title").data("ctx");$url=$ctx+$url;var breadCrumbs=eachBreadCrumbs($url,$title,false);var operator=($url.indexOf("?")!=-1)?"&":"?";$url+=operator+"breadCrumbsStr="+encodeURI(JSON.stringify(breadCrumbs));window.location.href=$url}$("body").on("click",".onebean-bread-crumbs-group a",function(){var $url=$(this).data("url");var $title=$(this).html();var breadCrumbs=eachBreadCrumbs($url,$title,false);var operator=($url.indexOf("?")!=-1)?"&":"?";$url+=operator+"breadCrumbsStr="+encodeURI(JSON.stringify(breadCrumbs));window.location.href=$url});function eachBreadCrumbs($url,$title,$isStartPage){var $temp;var breadCrumbs=justEachBreadCrumbs($isStartPage);$temp={};$temp.breadCrumbsUrl=$url;$temp.breadCrumbsTitle=$title;breadCrumbs.push($temp);return breadCrumbs}function justEachBreadCrumbs($isStartPage){var $temp;var breadCrumbs=new Array();if(!$isStartPage){var $breadCrumbs=$(".onebean-bread-crumbs-group").find("a");$.each($breadCrumbs,function(i,e){$temp={};$temp.breadCrumbsUrl=$(e).data("url");$temp.breadCrumbsTitle=$(e).html();breadCrumbs.push($temp)})}return breadCrumbs}function goUrl(url){window.location.href=url}function foldingChildTree(target){var pid=$(target).parents("tr").data("id");foldingChildTree2ed(target,pid)}function foldingChildTree2ed(target,ppid){var pid=$(target).parents("tr").data("id");var $childTrees=$("#example-r").find($("tr[data-pid="+pid+"]"));var $parent=$("#example-r").find($("tr[data-id="+pid+"]"));var $temp;for(var i=0;i<$childTrees.length;i++){$temp=$($childTrees.get(i));var isHide=$temp.attr("isHide");var hideChild=$parent.attr("hideChild");if(pid==ppid){foldingChildTree3th($temp,target,isHide,$parent,ppid,hideChild,false,i)}else{if((isHide=="false"&&$parent.attr("hideChild")=="false")||(isHide=="true"&&$parent.attr("hideChild")=="false")){foldingChildTree3th($temp,target,isHide,$parent,ppid,hideChild,true,i)}}}}function foldingChildTree3th($temp,target,isHide,$parent,ppid,hideChild,cross,index){$temp.toggle();var $icon=$(target).find("i");isHide=(isHide=="true")?false:true;hideChild=(hideChild=="true")?true:false;hideChild=(!cross&&index==0)?!hideChild:hideChild;if(hideChild){$icon.addClass("am-icon-folder");$icon.removeClass("am-icon-folder-open")}else{$icon.addClass("am-icon-folder-open");$icon.removeClass("am-icon-folder")}$temp.attr("isHide",isHide);$parent.attr("hideChild",hideChild);foldingChildTree2ed($temp.find("a"),ppid)}function getTodayDataStr(){var myDate=new Date();var year=myDate.getFullYear();var month=myDate.getMonth()+1<10?"0"+(myDate.getMonth()+1):myDate.getMonth()+1;var day=myDate.getDate()<10?"0"+myDate.getDate():myDate.getDate();myDate.getFullYear()+"-"+month;var dateStr=year+"-"+month+"-"+day+" 00:00:00";return dateStr}function initDataPicker(){$(".onebean-data-picker-data").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:00",autoclose:true,todayBtn:true,startDate:getTodayDataStr()});
    $(".onebean-data-picker-time").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:00",autoclose:true,startView:1,minView:0,maxView:1})}function unComments(domIDName){try{var content=document.getElementById(domIDName);content.innerHTML=content.innerHTML.replace("<!--","").replace("-->","")}catch(e){}};